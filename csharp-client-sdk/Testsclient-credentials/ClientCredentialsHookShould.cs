//------------------------------------------------------------------------------
// <auto-generated>
// This code was generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
//
// Changes to this file may cause incorrect behavior and will be lost when
// the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
using Polly;
using RestSharp;
using Xunit;
using System;
using System.Linq;
using System.Net;
using System.Threading.Tasks;
using Speakeasy.Client.Credentials;
using Speakeasy.Client.Credentials.Hooks;
using Speakeasy.Client.Credentials.Models.Components;

public class ClientCredentialsHookShould
{
    [Fact]
    public void TestAdditionalDependencies()
    {
        RestClient client = null;
        var policy = Policy.Handle<Exception>().Retry(1);

        policy.Execute(() => {
            client = new RestClient("http://example.com");
        });

        Assert.NotNull(client);
    }

    [Fact]
    public async Task TestClientCredentialsHookSuccessfullyAuthenticates()
    {
        CommonHelpers.RecordTest("hooks-client-credentials-success");

        var sdk = new SDK(security: new Security() {
            ClientID = "speakeasy-sdks",
            ClientSecret = $"supersecret-{randSeq(10)}",
        });

        var res = await sdk.AuthenticatedRequestAsync(null);
        Assert.NotNull(res);
        Assert.Equal(HttpStatusCode.OK, res.HttpMeta.Response.StatusCode);

        res = await sdk.AuthenticatedRequestAsync(null);
        Assert.NotNull(res);
        Assert.Equal(HttpStatusCode.OK, res.HttpMeta.Response.StatusCode);
    }

    public string randSeq(int n)
    {
        var rdm = new Random();
        const string chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
        return new string(Enumerable.Repeat(chars, n).Select(s => s[rdm.Next(s.Length)]).ToArray());
    }

}
