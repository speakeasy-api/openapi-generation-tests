// Code generated by Speakeasy (https://speakeasyapi.com). DO NOT EDIT.

import XCTest
@testable import OpenAPI

class AuthTests: XCTestCase {
    // Bit of a hack but do this once in a class-based test setup function so this is run once for the entire test suite.
    // Doesn't work if only single test classes are run.
    override class func setUp() {
        do {
            try resetTestRecords()
        } catch {
            print("Couldn't reset test record file")
        }
    }

    func testNoAuth() async throws {
        try recordTest(named: "auth-hoisted-no-auth-retained")

        let client = Client(security: nil)
        let response = try await client.auth.noAuth()
        XCTAssertEqual(response.statusCode, 200, "Request should succeed")
    }

    func testBasicAuth() async throws {
        try recordTest(named: "auth-hoisted-basic-auth")

        let client = Client(security: .basic(username: "testUser", password: "testPass"))
        let response = try await client.auth.basicAuth(
          request: .init(passwd: "testPass", user: "testUser")
        )
        XCTAssertEqual(response.statusCode, 200, "Request should succeed")
        XCTAssertEqual(try response.data.user().authenticated, true, "User should be authenticated")
    }

    func testMultipleMixedOptionsAuth() async throws {
        try recordTest(named: "auth-hoisted-operation-auth-retained")

        let client = Client(security: nil)
        let response = try await client.authNew.multipleMixedOptionsAuth(
          request: .init(basicAuth: .init(username: "testUser", password: "testPass")),
          security: .basic(.init(username: "testUser", password: "testPass")),
          server: nil
        )

        XCTAssertNotNil(response, "Response should not be nil")
    }
}
