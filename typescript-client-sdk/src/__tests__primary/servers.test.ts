/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import { expect, test } from "vitest";

import { SDK, ServerList, ServerSomething } from "../index.js";
import {
  SelectServerWithIDServerBroken,
  SelectServerWithIDServerList,
  SelectServerWithIDServerValid,
} from "../sdk/models/operations/selectserverwithid.js";
import { ServerWithTemplatesServerList } from "../sdk/models/operations/serverwithtemplates.js";
import { pathToFunc } from "../lib/url.js";
import { recordTest } from "./common_helpers.js";
import {
  ConnectionError,
  RequestTimeoutError,
} from "../sdk/models/errors/httpclienterrors.js";

test("Test Select Global Server Valid", async () => {
  recordTest("servers-select-global-server-valid");

  const sdk = new SDK({ serverURL: ServerList[0] });
  const res = await sdk.servers.selectGlobalServer();
  expect(res.httpMeta.response.status).toBe(200);
});

test("Test Select Global Server Broken", async () => {
  recordTest("servers-select-global-server-broken");

  const sdk = new SDK({ serverIdx: 1 });

  try {
    await sdk.servers.selectGlobalServer({ timeoutMs: 1000 });
    expect.unreachable("expected error to be thrown");
  } catch (err: unknown) {
    switch (true) {
      case err instanceof ConnectionError:
      case err instanceof RequestTimeoutError:
        break;
      default:
        expect.fail(
          "expected error to be ConnectionError or RequestTimeoutError",
        );
    }
  }
});

test("Test Select Server With ID Default", async () => {
  recordTest("servers-select-server-with-id-default");

  const sdk = new SDK();
  const res = await sdk.servers.selectServerWithID();
  expect(res.httpMeta.response.status).toBe(200);
});

test("Test Select Server With ID Valid", async () => {
  recordTest("servers-select-server-with-id-valid");

  const sdk = new SDK({ serverURL: "http://broken" }); // broken server overridden by operation
  const res = await sdk.servers.selectServerWithID({
    serverURL: SelectServerWithIDServerList[SelectServerWithIDServerValid],
  });
  expect(res.httpMeta.response.status).toBe(200);
});

test("Test Select Server With ID Broken", async () => {
  recordTest("servers-select-server-with-id-broken");

  const sdk = new SDK();

  try {
    await sdk.servers.selectServerWithID({
      serverURL: SelectServerWithIDServerList[SelectServerWithIDServerBroken],
      timeoutMs: 1000,
    });
    expect.unreachable("Expected error to be thrown");
  } catch (err: unknown) {
    switch (true) {
      case err instanceof ConnectionError:
      case err instanceof RequestTimeoutError:
        break;
      default:
        expect.fail(
          "expected error to be ConnectionError or RequestTimeoutError",
        );
    }
  }
});

test("Test Server with Templates Global", async () => {
  recordTest("servers-server-with-templates-global");

  const sdk = new SDK({
    serverIdx: 2,
    hostname: "localhost",
    port: "35123",
  });

  const res = await sdk.servers.serverWithTemplatesGlobal();
  expect(res.httpMeta.response.status).toBe(200);
});

test("Test Server with Templates Global Defaults", async () => {
  recordTest("servers-server-with-templates-global-defaults");

  const sdk = new SDK({
    serverIdx: 2,
  });

  const res = await sdk.servers.serverWithTemplatesGlobal();
  expect(res.httpMeta.response.status).toBe(200);
});

test("Test Server with Templates Global Enum", async () => {
  recordTest("servers-server-with-templates-global-enum");

  const sdk = new SDK({
    serverIdx: 3,
    something: ServerSomething.SomethingElseAgain,
  });

  const res = await sdk.servers.serverWithTemplatesGlobal();
  expect(res.httpMeta.response.status).toBe(200);
});

test("Test Server with Templates", async () => {
  recordTest("servers-server-with-templates");

  const sdk = new SDK();

  const serverURL = pathToFunc(ServerWithTemplatesServerList[0])({
    hostname: "localhost",
    port: "35123",
  });

  const res = await sdk.servers.serverWithTemplates({ serverURL });

  expect(res.httpMeta.response.status).toBe(200);
});

test("Test Server with Templates Defaults", async () => {
  recordTest("servers-server-with-templates-defaults");

  const sdk = new SDK();

  const res = await sdk.servers.serverWithTemplates();

  expect(res.httpMeta.response.status).toBe(200);
});

test("Test Server by ID with Templates", async () => {
  recordTest("servers-server-by-id-with-templates");

  const sdk = new SDK();

  const res = await sdk.servers.serversByIDWithTemplates();

  expect(res.httpMeta.response.status).toBe(200);
});

test("Test Servers Global Server With Templated Protocol", async () => {
  recordTest("servers-global-server-with-templated-protocol");

  const sdk = new SDK({
    serverIdx: 4,
    protocol: "http",
    hostname: "localhost",
    port: "35123",
  });

  const res = await sdk.servers.selectGlobalServer();

  expect(res.httpMeta.response.status).toBe(200);
  expect(res.httpMeta.response.url).toEqual(
    "http://localhost:35123/anything/selectGlobalServer",
  );
});

test("Test Servers Global Server With Invalid Templated Protocol", async () => {
  recordTest("servers-global-server-with-invalid-templated-protocol");

  const sdk = new SDK({
    serverIdx: 4,
    protocol: "invalid",
    hostname: "localhost",
    port: "35123",
  });

  try {
    await sdk.servers.selectGlobalServer();
    expect.unreachable("Expected error to be thrown");
  } catch (err) {
    expect(err).toBeInstanceOf(ConnectionError);
    expect(err).toHaveProperty(["cause", "cause", "message"], "unknown scheme");
  }
});
